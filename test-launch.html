<!DOCTYPE html>
<html>
<head>
    <title>Test Launch</title>
    <style>
        body { font-family: monospace; padding: 20px; background: #1e1e1e; color: #ddd; }
        button { padding: 10px 20px; margin: 5px; background: #007acc; color: white; border: none; cursor: pointer; }
        button:hover { background: #005a9e; }
        #log { background: #0d0d0d; padding: 10px; margin-top: 20px; max-height: 400px; overflow-y: auto; white-space: pre-wrap; }
    </style>
</head>
<body>
    <h1>Mossy Launch Diagnostic</h1>
    
    <div>
        <button onclick="testAPI()">Test API Availability</button>
        <button onclick="testSettings()">Load Settings</button>
        <button onclick="testScan()">Run Program Scan</button>
        <button onclick="testLaunchPath()" >Test Launch (G:/modding/MO2/ModOrganizer.exe)</button>
    </div>
    
    <div id="log">Ready...</div>

    <script>
        const log = (...args) => {
            const el = document.getElementById('log');
            const msg = args.map(a => typeof a === 'string' ? a : JSON.stringify(a, null, 2)).join(' ');
            el.textContent += '\n' + msg;
            el.scrollTop = el.scrollHeight;
        };

        async function testAPI() {
            log('[TEST] Checking API...');
            const api = window.electron?.api || window.electronAPI;
            log('[RESULT] API available:', !!api);
            if (api) {
                log('[RESULT] API methods:', Object.keys(api).slice(0, 10).join(', '));
            }
        }

        async function testSettings() {
            log('[TEST] Loading settings...');
            try {
                const api = window.electron?.api || window.electronAPI;
                if (!api) throw new Error('No API');
                const settings = await api.getSettings();
                log('[RESULT] Settings:', settings);
            } catch (e) {
                log('[ERROR]', e.message);
            }
        }

        async function testScan() {
            log('[TEST] Running program scan...');
            try {
                const api = window.electron?.api || window.electronAPI;
                if (!api) throw new Error('No API');
                if (!api.detectPrograms) throw new Error('detectPrograms not available');
                const progs = await api.detectPrograms();
                log('[RESULT] Found', progs.length, 'programs');
                const mo2 = progs.find(p => p.displayName.includes('Organizer') || p.name.includes('MO2'));
                if (mo2) log('[RESULT] MO2 found:', mo2);
            } catch (e) {
                log('[ERROR]', e.message);
            }
        }

        async function testLaunchPath() {
            const testPath = 'G:\\Modding\\MO2\\ModOrganizer.exe';
            log(`[TEST] Launching: ${testPath}`);
            try {
                const api = window.electron?.api || window.electronAPI;
                if (!api) throw new Error('No API');
                if (!api.openProgram) throw new Error('openProgram not available');
                const result = await api.openProgram(testPath);
                log('[RESULT]', result);
            } catch (e) {
                log('[ERROR]', e.message, e.stack);
            }
        }

        window.addEventListener('load', () => log('[READY] Test page loaded. Click buttons to test.'));
    </script>
</body>
</html>
