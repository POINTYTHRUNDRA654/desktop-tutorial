import{r as u,j as e,v as y,Z as I,C as P}from"./index-CEqdjNqX.js";import{U}from"./upload-CcCAxFJ0.js";import{F as $}from"./file-code-BmPtfYDB.js";import{T as C}from"./triangle-alert-zWUHrt1_.js";import{I as L}from"./info-Taof5RXs.js";import{C as G}from"./circle-x-CTIhp6Mn.js";const Q=()=>{const[g,b]=u.useState(""),[S,k]=u.useState(""),[i,A]=u.useState(null),[w,j]=u.useState(!1),F=s=>{var m;const r=(m=s.target.files)==null?void 0:m[0];if(r&&r.name.endsWith(".psc")){k(r.name);const c=new FileReader;c.onload=f=>{var h;const p=(h=f.target)==null?void 0:h.result;b(p)},c.readAsText(r)}},E=()=>{j(!0),setTimeout(()=>{const s=g.split(`
`),r=[];let m="",c="";const f=[],p=[],h=[];s.forEach((x,l)=>{var N;const n=x.trim(),o=l+1;if(n.toLowerCase().startsWith("scriptname")){const t=n.match(/scriptname\s+(\w+)(?:\s+extends\s+(\w+))?/i);t&&(m=t[1],c=t[2]||"Form")}if(n.toLowerCase().includes("property")){const t=n.match(/(\w+)\s+property\s+(\w+)/i);t&&f.push(`${t[1]} ${t[2]}`)}if(n.toLowerCase().startsWith("event")){const t=n.match(/event\s+(\w+)/i);t&&p.push(t[1])}if(n.toLowerCase().startsWith("function")){const t=n.match(/function\s+(\w+)/i);t&&h.push(t[1])}if(l===0&&!n.toLowerCase().startsWith("scriptname")&&r.push({line:o,severity:"error",message:"Missing ScriptName declaration",suggestion:'Add "ScriptName YourScriptName extends Quest" at the top'}),n.toLowerCase().startsWith("event")){let t=!1;for(let a=l+1;a<s.length;a++){if(s[a].trim().toLowerCase()==="endevent"){t=!0;break}if(s[a].trim().toLowerCase().startsWith("event")||s[a].trim().toLowerCase().startsWith("function"))break}t||r.push({line:o,severity:"error",message:"Event missing EndEvent",suggestion:'Add "EndEvent" to close this event block'})}if(n.toLowerCase().startsWith("function")&&!n.toLowerCase().includes("native")){let t=!1;for(let a=l+1;a<s.length;a++){if(s[a].trim().toLowerCase()==="endfunction"){t=!0;break}if(s[a].trim().toLowerCase().startsWith("event")||s[a].trim().toLowerCase().startsWith("function"))break}t||r.push({line:o,severity:"error",message:"Function missing EndFunction",suggestion:'Add "EndFunction" to close this function block'})}if(n.toLowerCase().startsWith("while")){const t=n.match(/while\s+(\w+)/i);if(t){const a=t[1];let v=!1;for(let d=l+1;d<s.length&&s[d].trim().toLowerCase()!=="endwhile";d++)if(s[d].includes(a)&&(s[d].includes("=")||s[d].includes("+")||s[d].includes("-"))){v=!0;break}v||r.push({line:o,severity:"warning",message:`Possible infinite loop: variable "${a}" not modified in loop`,suggestion:`Ensure "${a}" is modified inside the loop to prevent infinite execution`})}}if((x.toLowerCase().includes("while")||x.toLowerCase().includes("if"))&&((N=s[l+1])!=null&&N.toLowerCase().includes("getdistance"))&&r.push({line:o+1,severity:"warning",message:"GetDistance() called in conditional - performance concern",suggestion:"Cache the distance in a variable before the loop/condition"}),n.toLowerCase().includes("property")&&!n.toLowerCase().includes("auto")&&!n.toLowerCase().includes("autoreadonly")){let t=!1;for(let a=l+1;a<Math.min(l+10,s.length);a++)if(s[a].trim().toLowerCase().includes("function get()")){t=!0;break}t||r.push({line:o,severity:"warning",message:"Property declared without Auto or getter/setter",suggestion:'Add "Auto" keyword or define Get()/Set() functions'})}if(n.toLowerCase()==="event oninit()"||n.toLowerCase()==="event oninit"){let t=!1;for(let a=l+1;a<s.length&&s[a].trim().toLowerCase()!=="endevent";a++)if(s[a].toLowerCase().includes("parent.oninit()")){t=!0;break}!t&&c&&c!=="Form"&&r.push({line:o,severity:"info",message:"OnInit event should call Parent.OnInit()",suggestion:'Add "Parent.OnInit()" at the start of the event'})}(n.includes('== ""')||n.includes('!= ""'))&&r.push({line:o,severity:"info",message:"Comparing string to empty string",suggestion:"Use StringUtil.GetLength() for better performance"})}),r.sort((x,l)=>x.line-l.line),A({scriptName:m||"Unknown",extends:c||"Unknown",properties:f,events:p,functions:h,issues:r,lineCount:s.length}),j(!1)},800)},W=s=>{switch(s){case"error":return e.jsx(G,{className:"w-4 h-4 text-red-500"});case"warning":return e.jsx(C,{className:"w-4 h-4 text-yellow-500"});case"info":return e.jsx(L,{className:"w-4 h-4 text-blue-500"});default:return e.jsx(L,{className:"w-4 h-4"})}},z=s=>{switch(s){case"error":return"border-red-500/50 bg-red-900/20";case"warning":return"border-yellow-500/50 bg-yellow-900/20";case"info":return"border-blue-500/50 bg-blue-900/20";default:return"border-slate-700"}};return e.jsxs("div",{className:"h-full bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"p-6 border-b border-slate-700 bg-slate-800/50",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(y,{className:"w-8 h-8 text-purple-400"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-white",children:"Papyrus Script Analyzer"}),e.jsx("p",{className:"text-sm text-slate-400",children:"Detect issues, optimize performance, validate syntax"})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("label",{className:"flex-1 flex items-center gap-2 px-4 py-3 bg-slate-900 hover:bg-slate-800 border border-slate-700 rounded-lg cursor-pointer transition-colors",children:[e.jsx(U,{className:"w-5 h-5 text-slate-400"}),e.jsx("span",{className:"text-sm text-slate-300",children:S||"Upload .psc file"}),e.jsx("input",{type:"file",accept:".psc",onChange:F,className:"hidden"})]}),e.jsx("button",{onClick:E,disabled:!g||w,className:"px-6 py-3 bg-purple-600 hover:bg-purple-500 disabled:opacity-50 disabled:cursor-not-allowed text-white font-bold rounded-lg flex items-center gap-2 transition-colors",children:w?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Analyzing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(I,{className:"w-5 h-5"}),"Analyze"]})})]})]}),e.jsxs("div",{className:"flex-1 overflow-hidden flex gap-4 p-6",children:[e.jsxs("div",{className:"flex-1 flex flex-col bg-slate-900 border border-slate-700 rounded-xl overflow-hidden",children:[e.jsx("div",{className:"p-3 border-b border-slate-700 bg-slate-800/50",children:e.jsxs("h3",{className:"font-bold text-white text-sm flex items-center gap-2",children:[e.jsx($,{className:"w-4 h-4"}),"Script Source"]})}),e.jsx("textarea",{value:g,onChange:s=>b(s.target.value),placeholder:"Paste your Papyrus script here or upload a .psc file...",className:"flex-1 bg-slate-950 text-slate-200 font-mono text-sm p-4 resize-none focus:outline-none",spellCheck:!1})]}),e.jsxs("div",{className:"flex-1 flex flex-col bg-slate-900 border border-slate-700 rounded-xl overflow-hidden",children:[e.jsx("div",{className:"p-3 border-b border-slate-700 bg-slate-800/50",children:e.jsx("h3",{className:"font-bold text-white text-sm",children:"Analysis Results"})}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[!i&&e.jsxs("div",{className:"text-center py-12 text-slate-500",children:[e.jsx(y,{className:"w-16 h-16 mx-auto mb-4 opacity-20"}),e.jsx("p",{children:"Upload or paste a script and click Analyze"})]}),i&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-slate-800 rounded-lg p-4 border border-slate-700",children:[e.jsx("h4",{className:"font-bold text-white mb-3",children:"Script Information"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-slate-400",children:"Script Name:"}),e.jsx("span",{className:"text-white font-mono",children:i.scriptName})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-slate-400",children:"Extends:"}),e.jsx("span",{className:"text-white font-mono",children:i.extends})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-slate-400",children:"Lines:"}),e.jsx("span",{className:"text-white font-mono",children:i.lineCount})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-slate-400",children:"Properties:"}),e.jsx("span",{className:"text-white font-mono",children:i.properties.length})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-slate-400",children:"Events:"}),e.jsx("span",{className:"text-white font-mono",children:i.events.length})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-slate-400",children:"Functions:"}),e.jsx("span",{className:"text-white font-mono",children:i.functions.length})]})]})]}),e.jsxs("div",{className:"bg-slate-800 rounded-lg p-4 border border-slate-700",children:[e.jsx("h4",{className:"font-bold text-white mb-3 flex items-center gap-2",children:i.issues.length===0?e.jsxs(e.Fragment,{children:[e.jsx(P,{className:"w-5 h-5 text-green-500"}),"No Issues Found"]}):e.jsxs(e.Fragment,{children:[e.jsx(C,{className:"w-5 h-5 text-yellow-500"}),i.issues.length," Issue",i.issues.length!==1?"s":""," Detected"]})}),i.issues.length===0&&e.jsx("p",{className:"text-sm text-slate-400",children:"Script appears to be properly structured!"})]}),i.issues.map((s,r)=>e.jsx("div",{className:`rounded-lg p-4 border ${z(s.severity)}`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[W(s.severity),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsxs("span",{className:"text-xs font-mono text-slate-500",children:["Line ",s.line]}),e.jsx("span",{className:"text-xs font-bold text-slate-400 uppercase",children:s.severity})]}),e.jsx("p",{className:"text-sm text-white font-medium mb-2",children:s.message}),s.suggestion&&e.jsxs("div",{className:"text-xs text-slate-400 bg-slate-950/50 p-2 rounded border border-slate-700",children:[e.jsx("span",{className:"font-bold text-slate-300",children:"Suggestion: "}),s.suggestion]})]})]})},r))]})]})]})]})]})};export{Q as ScriptAnalyzer};
