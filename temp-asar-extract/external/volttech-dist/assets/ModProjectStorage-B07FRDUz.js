const l="mossy_mod_projects",i="mossy_current_mod";class u{static createModProject(t){const s=`mod_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,e=Date.now(),o={id:s,name:t.name,description:t.description||"",type:t.type,status:"planning",version:"0.1.0",author:t.author,createdAt:e,updatedAt:e,steps:[],completionPercentage:0,requirements:t.requirements||[],dependencies:t.dependencies||[],tags:[],notes:"",resourcesLinks:[],projectPath:t.projectPath,espName:t.espName},n=this.getAllProjects();return n.push(o),localStorage.setItem(l,JSON.stringify(n)),o}static getProject(t){return this.getAllProjects().find(e=>e.id===t)||null}static getAllProjects(){try{const t=localStorage.getItem(l);return t?JSON.parse(t):[]}catch{return[]}}static updateProject(t,s){const e=this.getAllProjects(),o=e.findIndex(r=>r.id===t);if(o===-1)return null;const n=e[o];return e[o]={...n,...s,updatedAt:Date.now(),completionPercentage:this.calculateCompletion(n)},localStorage.setItem(l,JSON.stringify(e)),e[o]}static deleteProject(t){const s=this.getAllProjects(),e=s.filter(o=>o.id!==t);return e.length===s.length?!1:(localStorage.setItem(l,JSON.stringify(e)),this.getCurrentModId()===t&&localStorage.removeItem(i),!0)}static addStep(t,s){const e=this.getProject(t);if(!e)return null;const n={id:`step_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,title:s.title,description:s.description||"",status:"pending",priority:s.priority||"medium",notes:"",toolsUsed:s.toolsUsed||[],createdAt:Date.now(),estimatedHours:s.estimatedHours};e.steps.push(n),e.updatedAt=Date.now(),e.completionPercentage=this.calculateCompletion(e);const r=this.getAllProjects(),c=r.findIndex(a=>a.id===t);return c!==-1&&(r[c]=e,localStorage.setItem(l,JSON.stringify(r))),n}static updateStep(t,s,e){const o=this.getProject(t);if(!o)return null;const n=o.steps.findIndex(d=>d.id===s);if(n===-1)return null;const r=o.steps[n];o.steps[n]={...r,...e},e.status==="completed"&&!r.completedAt&&(o.steps[n].completedAt=Date.now()),o.updatedAt=Date.now(),o.completionPercentage=this.calculateCompletion(o);const c=this.getAllProjects(),a=c.findIndex(d=>d.id===t);return a!==-1&&(c[a]=o,localStorage.setItem(l,JSON.stringify(c))),o.steps[n]}static deleteStep(t,s){const e=this.getProject(t);if(!e)return!1;const o=e.steps.filter(c=>c.id!==s);if(o.length===e.steps.length)return!1;e.steps=o,e.updatedAt=Date.now(),e.completionPercentage=this.calculateCompletion(e);const n=this.getAllProjects(),r=n.findIndex(c=>c.id===t);return r!==-1&&(n[r]=e,localStorage.setItem(l,JSON.stringify(n))),!0}static getProjectListItems(){return this.getAllProjects().map(t=>({id:t.id,name:t.name,type:t.type,status:t.status,version:t.version,completionPercentage:t.completionPercentage,updatedAt:t.updatedAt,stepCount:t.steps.length,completedStepCount:t.steps.filter(s=>s.status==="completed").length}))}static setCurrentMod(t){return this.getProject(t)?(localStorage.setItem(i,t),!0):!1}static getCurrentMod(){const t=localStorage.getItem(i);return t?this.getProject(t):null}static getCurrentModId(){return localStorage.getItem(i)}static clearCurrentMod(){localStorage.removeItem(i)}static calculateCompletion(t){if(t.steps.length===0)return 0;const s=t.steps.filter(e=>e.status==="completed").length;return Math.round(s/t.steps.length*100)}static getProjectStats(t){const s=this.getProject(t);if(!s)return null;const e=s.steps.filter(r=>r.status==="completed"),o=s.steps.reduce((r,c)=>r+(c.estimatedHours||0),0),n=s.steps.reduce((r,c)=>r+(c.actualHours||0),0);return{totalSteps:s.steps.length,completedSteps:e.length,pendingSteps:s.steps.filter(r=>r.status==="pending").length,inProgressSteps:s.steps.filter(r=>r.status==="in-progress").length,blockedSteps:s.steps.filter(r=>r.status==="blocked").length,completionPercentage:s.completionPercentage,totalEstimatedHours:o,totalActualHours:n,averageHoursPerStep:s.steps.length>0?(n/e.length||0).toFixed(1):0}}}export{u as ModProjectStorage};
