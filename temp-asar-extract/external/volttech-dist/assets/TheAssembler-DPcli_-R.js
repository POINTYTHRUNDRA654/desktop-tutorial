import{c as K,r as d,u as _,j as e,P as y,S as Q,q as g,v as Y,F as Z,k as ee,h as te,I as se}from"./index-CEqdjNqX.js";import{E as le}from"./ExternalToolNotice-6VoxpV0f.js";import{E as ae}from"./external-link-BPyz4xeM.js";import{I as re}from"./info-Taof5RXs.js";import{D as $}from"./download-BCBaShzR.js";import{E as oe}from"./eye-Dh4PfBEc.js";import{F as k}from"./file-text-5HrwYzdb.js";import{T as ne}from"./trash-2-hMnUtzOy.js";import{R as ie}from"./refresh-cw-DBu6amVw.js";import{P as ce}from"./plus-o7XHxYp5.js";import{C as de}from"./chevron-down-HPljEmI-.js";import"./play-txtn9UkQ.js";/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xe=[["path",{d:"M21 10.656V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h12.344",key:"2acyp4"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],C=K("square-check-big",xe),Ee=()=>{const[c,u]=d.useState([]),[i,S]=d.useState(null),[f,w]=d.useState("editor"),[j,O]=d.useState(!1),[M,me]=d.useState([]),[E,pe]=d.useState("New Mod Project"),[I,he]=d.useState("User"),[U,ue]=d.useState("1.0.0"),[A,fe]=d.useState(""),[b,T]=d.useState(null),R=_();d.useEffect(()=>{(async()=>{try{const s=await window.electronAPI.getSettings();T(s),window.electronAPI.onSettingsUpdated(l=>T(l))}catch(s){console.warn("[Assembler] Failed to load settings",s)}})()},[]);const p=(t,s)=>{for(const l of t){if(l.id===s)return l;if(l.children){const a=p(l.children,s);if(a)return a}}return null},h=(t,s)=>{const l=a=>a.map(r=>r.id===t?{...r,...s}:r.children?{...r,children:l(r.children)}:r);u(l(c))},G=t=>{const s=p(c,t);s&&h(t,{isExpanded:!s.isExpanded})},z=t=>{const s=l=>l.filter(a=>a.id!==t).map(a=>({...a,children:a.children?s(a.children):void 0}));u(s(c)),i===t&&S(null)},B=async()=>{var s,l;const t=b!=null&&b.fomodCreatorPath&&b.fomodCreatorPath.trim().length>0?b.fomodCreatorPath:"G:\\Tools\\FOMOD Creation Tool 1.7-6821-1-7\\FomodDesigner.exe";try{(l=(s=window.electron)==null?void 0:s.api)!=null&&l.openExternal?await window.electron.api.openExternal(t):alert("External tool launch requires Desktop Bridge connection.")}catch(a){console.error("Failed to launch FOMOD Tool:",a);const r=`Could not launch FOMOD Creation Tool.

The tool was not found at:
${t}

Download it from Nexus Mods:
https://www.nexusmods.com/fallout4/mods/6821

After installing, you may need to update the tool path in settings.`;alert(r)}},V=()=>{if(!n||n.type!=="option")return;const t=document.createElement("input");t.type="file",t.multiple=!0,t.onchange=s=>{const a=Array.from(s.target.files||[]).map(r=>r.name);h(n.id,{files:a.map(r=>({source:r,dest:r}))})},t.click()},N=(t,s)=>{const l={id:Date.now().toString(),type:s,name:`New ${s.charAt(0).toUpperCase()+s.slice(1)}`,isExpanded:!0,children:s!=="option"?[]:void 0};if(!t){s==="page"&&u([...c,l]);return}const a=r=>r.map(o=>o.id===t?{...o,children:[...o.children||[],l]}:o.children?{...o,children:a(o.children)}:o);u(a(c))},q=async()=>{O(!0);try{const t=new te({apiKey:"AIzaSyB0n0hMsy-ilO2znsdTb0exWJt3L-UtAv4"}),s=`
            Act as a FOMOD installer architect.
            I have these files in my mod folder: ${JSON.stringify(M)}.
            
            Analyze the filenames to determine logical grouping (e.g. Resolution options, Patches).
            Generate a JSON structure representing the FOMOD pages/groups/options.
            Structure format: Array of Objects.
            - type: "page" | "group" | "option"
            - name: string
            - description: string
            - groupType: "SelectExactlyOne" | "SelectAny" (only for groups)
            - children: array of same objects.
            
            Do not include file paths mapping, just the visual structure.
            `;let x=(await(await t.getGenerativeModel({model:"gemini-1.5-flash",generationConfig:{responseMimeType:"application/json"}}).generateContent(s)).response).text().replace(/```json/g,"").replace(/```/g,"").trim();const m=JSON.parse(x),L=X=>X.map((v,H)=>({...v,id:`gen-${Date.now()}-${H}-${Math.random()}`,isExpanded:!0,children:v.children?L(v.children):void 0}));u(L(m))}catch(t){console.error(t),alert("Failed to auto-generate structure. AI returned invalid format.")}finally{O(!1)}},F=()=>{let t=`<?xml version="1.0" encoding="UTF-8"?>
`;return t+=`<config xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="http://qconsulting.ca/fo3/ModConfig5.0.xsd">
`,t+=`  <moduleName>${E}</moduleName>
`,t+=`  <installSteps order="Explicit">
`,c.forEach(s=>{var l;t+=`    <installStep name="${s.name}">
`,t+=`      <optionalFileGroups order="Explicit">
`,(l=s.children)==null||l.forEach(a=>{var r;t+=`        <group name="${a.name}" type="${a.groupType}">
`,t+=`          <plugins order="Explicit">
`,(r=a.children)==null||r.forEach(o=>{t+=`            <plugin name="${o.name}">
`,t+=`              <description>${o.description||""}</description>
`,o.imagePath&&(t+=`              <image path="${o.imagePath}" />
`),o.files&&o.files.length>0&&(t+=`              <files>
`,o.files.forEach(x=>{t+=`                <file source="${x.source}" destination="${x.dest}" />
`}),t+=`              </files>
`),t+=`              <typeDescriptor>
`,t+=`                <type name="Optional"/>
`,t+=`              </typeDescriptor>
`,t+=`            </plugin>
`}),t+=`          </plugins>
`,t+=`        </group>
`}),t+=`      </optionalFileGroups>
`,t+=`    </installStep>
`}),t+=`  </installSteps>
`,t+="</config>",t},W=()=>{let t=`<?xml version="1.0" encoding="UTF-8"?>
`;return t+=`<fomod>
`,t+=`  <Name>${E}</Name>
`,t+=`  <Author>${I}</Author>
`,t+=`  <Version>${U}</Version>
`,A&&(t+=`  <Website>${A}</Website>
`),t+="</fomod>",t},D=()=>{const t=F(),s=W(),l=new Blob([t],{type:"text/xml"}),a=URL.createObjectURL(l),r=document.createElement("a");r.href=a,r.download="ModuleConfig.xml",r.click(),URL.revokeObjectURL(a),setTimeout(()=>{const o=new Blob([s],{type:"text/xml"}),x=URL.createObjectURL(o),m=document.createElement("a");m.href=x,m.download="info.xml",m.click(),URL.revokeObjectURL(x)},100),alert("FOMOD files downloaded! Place ModuleConfig.xml in /fomod/ folder and info.xml in root.")},P=(t,s=0)=>t.map(l=>e.jsxs("div",{className:"select-none",children:[e.jsxs("div",{className:`flex items-center gap-2 py-1 px-2 cursor-pointer transition-colors border-l-2 ${i===l.id?"bg-slate-800 border-forge-accent text-white":"border-transparent text-slate-400 hover:bg-slate-800 hover:text-slate-200"}`,style:{paddingLeft:`${s*12+8}px`},onClick:a=>{a.stopPropagation(),S(l.id)},children:[e.jsx("button",{onClick:a=>{a.stopPropagation(),G(l.id)},className:"hover:text-white",children:l.children?l.isExpanded?e.jsx(de,{className:"w-3 h-3"}):e.jsx(ee,{className:"w-3 h-3"}):e.jsx("div",{className:"w-3 h-3"})}),l.type==="page"?e.jsx(k,{className:"w-3 h-3 text-blue-400"}):l.type==="group"?e.jsx(g,{className:"w-3 h-3 text-yellow-400"}):e.jsx(C,{className:"w-3 h-3 text-emerald-400"}),e.jsx("span",{className:"text-xs truncate",children:l.name})]}),l.isExpanded&&l.children&&e.jsx("div",{children:P(l.children,s+1)})]},l.id)),J=()=>{var s,l,a,r;const t=c[0];return t?e.jsxs("div",{className:"w-full max-w-2xl mx-auto bg-[#2d2d2d] border border-black shadow-2xl rounded-sm overflow-hidden flex flex-col h-[500px]",children:[e.jsxs("div",{className:"bg-gradient-to-b from-[#444] to-[#333] p-2 flex justify-between items-center border-b border-black",children:[e.jsx("span",{className:"text-xs font-bold text-white shadow-black drop-shadow-md",children:"Mod Organizer 2 - Installer"}),e.jsx("div",{className:"flex gap-1",children:e.jsx("div",{className:"w-3 h-3 bg-red-500 rounded-full opacity-50"})})]}),e.jsxs("div",{className:"flex-1 flex p-4 gap-4 bg-[url('https://www.transparenttextures.com/patterns/dark-leather.png')] bg-[#222]",children:[e.jsxs("div",{className:"w-1/3 bg-black border border-[#555] flex items-center justify-center relative",children:[i&&((s=p(c,i))!=null&&s.imagePath)?e.jsx("img",{src:`https://placehold.co/300x400/111/fff?text=${(l=p(c,i))==null?void 0:l.imagePath}`,className:"w-full h-full object-cover opacity-80"}):e.jsx(se,{className:"w-12 h-12 text-slate-700"}),e.jsx("div",{className:"absolute bottom-0 w-full bg-black/80 text-[10px] text-slate-300 p-1 text-center",children:"Preview"})]}),e.jsxs("div",{className:"flex-1 flex flex-col",children:[e.jsx("h2",{className:"text-xl font-bold text-slate-200 mb-4 border-b border-slate-600 pb-2",children:t.name}),e.jsx("div",{className:"flex-1 overflow-y-auto space-y-4 pr-2 custom-scrollbar",children:(a=t.children)==null?void 0:a.map(o=>{var x;return e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"text-xs font-bold text-[#e1ba5c] uppercase tracking-wider",children:o.name}),e.jsx("div",{className:"space-y-0.5",children:(x=o.children)==null?void 0:x.map(m=>e.jsxs("label",{className:"flex items-center gap-2 p-1 hover:bg-white/5 cursor-pointer group",children:[e.jsx("input",{type:o.groupType==="SelectExactlyOne"?"radio":"checkbox",name:o.id,className:"accent-[#e1ba5c] bg-[#333] border-[#555]"}),e.jsx("span",{className:"text-xs text-slate-300 group-hover:text-white transition-colors",children:m.name})]},m.id))})]},o.id)})}),e.jsx("div",{className:"h-24 mt-4 bg-black/40 border border-[#444] p-2 text-xs text-slate-400 font-mono overflow-y-auto",children:i?(r=p(c,i))==null?void 0:r.description:"Hover over an option to see details."})]})]}),e.jsxs("div",{className:"p-3 bg-[#333] border-t border-black flex justify-between",children:[e.jsx("button",{className:"px-4 py-1 bg-[#444] text-slate-300 text-xs border border-black shadow-inner",children:"Back"}),e.jsx("button",{className:"px-4 py-1 bg-[#444] text-slate-300 text-xs border border-black shadow-inner",children:"Next"})]})]}):e.jsx("div",{className:"text-slate-500 text-center mt-20",children:"No pages defined."})},n=i?p(c,i):null;return e.jsxs("div",{className:"h-full flex flex-col bg-forge-dark text-slate-200 font-sans",children:[e.jsxs("div",{className:"p-4 border-b border-slate-700 bg-forge-panel flex justify-between items-center shadow-md z-10",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-bold text-white flex items-center gap-3",children:[e.jsx(y,{className:"w-6 h-6 text-purple-400"}),"The Assembler"]}),e.jsx("p",{className:"text-xs text-slate-400 font-mono mt-1",children:"FOMOD Creation Tool v1.7"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>R("/settings/tools"),className:"px-4 py-2 bg-slate-800 hover:bg-slate-700 border border-slate-600 rounded text-xs font-bold flex items-center gap-2 transition-all",title:"Configure external tool paths",children:[e.jsx(Q,{className:"w-4 h-4"})," Tool Settings"]}),e.jsxs("button",{onClick:B,className:"px-4 py-2 bg-blue-700 hover:bg-blue-600 border border-blue-500 rounded text-xs font-bold flex items-center gap-2 transition-all group relative",title:"Launch FOMOD Creation Tool 1.7\\n\\nRequires: FOMOD Creation Tool (Download from Nexus Mods)\\nhttps://www.nexusmods.com/fallout4/mods/6821",children:[e.jsx(ae,{className:"w-4 h-4"})," Launch Tool",e.jsx(re,{className:"w-3 h-3 text-blue-300 opacity-50 group-hover:opacity-100 transition-opacity"})]}),e.jsxs("button",{onClick:D,className:"px-4 py-2 bg-emerald-700 hover:bg-emerald-600 border border-emerald-500 rounded text-xs font-bold flex items-center gap-2 transition-all",children:[e.jsx($,{className:"w-4 h-4"})," Export FOMOD"]}),e.jsxs("button",{onClick:()=>w("editor"),className:`px-3 py-1.5 rounded text-xs font-bold flex items-center gap-2 transition-all ${f==="editor"?"bg-purple-600 text-white":"bg-slate-800 text-slate-400 hover:text-white"}`,children:[e.jsx(g,{className:"w-4 h-4"})," Structure"]}),e.jsxs("button",{onClick:()=>w("preview"),className:`px-3 py-1.5 rounded text-xs font-bold flex items-center gap-2 transition-all ${f==="preview"?"bg-purple-600 text-white":"bg-slate-800 text-slate-400 hover:text-white"}`,children:[e.jsx(oe,{className:"w-4 h-4"})," Preview"]}),e.jsxs("button",{onClick:()=>w("xml"),className:`px-3 py-1.5 rounded text-xs font-bold flex items-center gap-2 transition-all ${f==="xml"?"bg-purple-600 text-white":"bg-slate-800 text-slate-400 hover:text-white"}`,children:[e.jsx(Y,{className:"w-4 h-4"})," XML"]})]})]}),e.jsx("div",{className:"px-4 pt-2",children:e.jsx(le,{toolKey:"fomodCreatorPath",toolName:"FOMOD Creation Tool",nexusUrl:"https://www.nexusmods.com/fallout4/mods/6821",description:"Use the external designer to finalize your installer. Configure the path and launch directly from here."})}),e.jsxs("div",{className:"flex-1 flex overflow-hidden",children:[e.jsxs("div",{className:"w-72 bg-slate-900 border-r border-slate-800 flex flex-col",children:[e.jsxs("div",{className:"p-2 border-b border-slate-800 flex justify-between items-center bg-slate-800/50",children:[e.jsx("span",{className:"text-[10px] uppercase font-bold text-slate-500",children:"Installer Tree"}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:()=>N(i,"page"),className:"p-1 hover:bg-slate-700 rounded text-slate-400",title:"Add Page",children:e.jsx(k,{className:"w-3 h-3"})}),e.jsx("button",{onClick:()=>N(i,"group"),className:"p-1 hover:bg-slate-700 rounded text-slate-400",title:"Add Group",children:e.jsx(g,{className:"w-3 h-3"})}),e.jsx("button",{onClick:()=>N(i,"option"),className:"p-1 hover:bg-slate-700 rounded text-slate-400",title:"Add Option",children:e.jsx(C,{className:"w-3 h-3"})}),e.jsx("button",{onClick:()=>i&&z(i),className:"p-1 hover:bg-red-900/50 rounded text-slate-400 hover:text-red-400",title:"Delete",children:e.jsx(ne,{className:"w-3 h-3"})})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-2",children:P(c)}),e.jsxs("div",{className:"p-4 border-t border-slate-800 bg-slate-900",children:[e.jsxs("h4",{className:"text-[10px] font-bold text-slate-500 uppercase mb-2 flex items-center gap-2",children:[e.jsx(Z,{className:"w-3 h-3"})," Auto-Assemble"]}),e.jsxs("div",{className:"text-[10px] text-slate-500 mb-2",children:["Detected ",M.length," files in workspace."]}),e.jsxs("button",{onClick:q,disabled:j,className:"w-full py-2 bg-purple-900/30 hover:bg-purple-900/50 border border-purple-500/30 text-purple-300 text-xs font-bold rounded flex items-center justify-center gap-2 transition-all disabled:opacity-50",children:[j?e.jsx(ie,{className:"w-3 h-3 animate-spin"}):e.jsx(y,{className:"w-3 h-3"}),j?"Analyzing...":"Generate Structure"]})]})]}),e.jsxs("div",{className:"flex-1 flex flex-col bg-[#0f151f] overflow-hidden relative",children:[e.jsx("div",{className:"absolute inset-0 opacity-5 pointer-events-none",style:{backgroundImage:"radial-gradient(#64748b 1px, transparent 1px)",backgroundSize:"20px 20px"}}),e.jsx("div",{className:"flex-1 overflow-auto p-8 flex items-center justify-center",children:f==="editor"?n?e.jsxs("div",{className:"w-full max-w-lg bg-slate-800 border border-slate-700 rounded-xl p-6 shadow-2xl relative z-10",children:[e.jsxs("h3",{className:"text-lg font-bold text-white mb-4 flex items-center gap-2",children:[n.type==="page"?e.jsx(k,{className:"w-5 h-5 text-blue-400"}):n.type==="group"?e.jsx(g,{className:"w-5 h-5 text-yellow-400"}):e.jsx(C,{className:"w-5 h-5 text-emerald-400"}),"Edit ",n.type.charAt(0).toUpperCase()+n.type.slice(1)]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase mb-1",children:"Name"}),e.jsx("input",{type:"text",value:n.name,onChange:t=>h(n.id,{name:t.target.value}),className:"w-full bg-slate-900 border border-slate-600 rounded p-2 text-sm text-white focus:border-purple-500 outline-none"})]}),n.type==="group"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase mb-1",children:"Selection Logic"}),e.jsxs("select",{value:n.groupType,onChange:t=>h(n.id,{groupType:t.target.value}),className:"w-full bg-slate-900 border border-slate-600 rounded p-2 text-sm text-white focus:border-purple-500 outline-none",children:[e.jsx("option",{value:"SelectExactlyOne",children:"Select Exactly One (Radio)"}),e.jsx("option",{value:"SelectAny",children:"Select Any (Checkbox)"}),e.jsx("option",{value:"SelectAtMostOne",children:"Select At Most One"})]})]}),n.type==="option"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase mb-1",children:"Description"}),e.jsx("textarea",{value:n.description||"",onChange:t=>h(n.id,{description:t.target.value}),className:"w-full h-24 bg-slate-900 border border-slate-600 rounded p-2 text-sm text-white focus:border-purple-500 outline-none resize-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase mb-1",children:"Image Path"}),e.jsx("input",{type:"text",value:n.imagePath||"",onChange:t=>h(n.id,{imagePath:t.target.value}),placeholder:"Images/preview.png",className:"w-full bg-slate-900 border border-slate-600 rounded p-2 text-sm text-white focus:border-purple-500 outline-none font-mono"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase mb-2",children:"Files to Install"}),e.jsxs("button",{onClick:V,className:"w-full px-3 py-2 bg-emerald-700 hover:bg-emerald-600 border border-emerald-500 rounded text-xs font-bold flex items-center justify-center gap-2 mb-2",children:[e.jsx(ce,{className:"w-4 h-4"}),"Assign Files"]}),n.files&&n.files.length>0&&e.jsx("div",{className:"space-y-1 max-h-24 overflow-y-auto bg-slate-900/50 border border-slate-700 rounded p-2",children:n.files.map((t,s)=>e.jsxs("div",{className:"text-xs text-slate-300 font-mono truncate",children:["ðŸ“„ ",t.source]},s))})]})]})]})]}):e.jsxs("div",{className:"text-slate-600 flex flex-col items-center",children:[e.jsx(y,{className:"w-16 h-16 mb-4 opacity-20"}),e.jsx("p",{children:"Select a node to edit properties."})]}):f==="xml"?e.jsxs("div",{className:"w-full h-full max-w-4xl bg-[#1e1e1e] border border-slate-700 rounded-lg overflow-hidden flex flex-col shadow-2xl relative z-10",children:[e.jsxs("div",{className:"bg-[#2d2d2d] p-2 border-b border-black text-xs text-slate-400 font-mono flex justify-between items-center",children:[e.jsx("span",{children:"ModuleConfig.xml"}),e.jsxs("button",{onClick:D,className:"text-purple-400 hover:text-white flex items-center gap-1",children:[e.jsx($,{className:"w-3 h-3"})," Export"]})]}),e.jsx("pre",{className:"flex-1 p-4 overflow-auto text-xs font-mono text-emerald-300 custom-scrollbar leading-relaxed",children:F()})]}):J()})]})]})]})};export{Ee as default};
