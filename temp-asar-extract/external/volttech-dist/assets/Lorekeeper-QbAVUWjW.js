import{c as Z,r as c,j as t,S as H,Z as U}from"./index-CEqdjNqX.js";import{F as q}from"./folder-_XQVCBIa.js";import{R as D}from"./refresh-cw-DBu6amVw.js";import{T as Q}from"./triangle-alert-zWUHrt1_.js";import{D as V}from"./database-V2h3OpNj.js";import{C as W}from"./copy-D3A4jLxT.js";/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X=[["path",{d:"m8 3 4 8 5-5 5 15H2L8 3z",key:"otkl63"}]],K=Z("mountain",X),oe=()=>{var R;const O=e=>{const r={},a=e.match(/Generated.*?:\s*([\w\-_\.\s\/]+\.nif)/gi);a&&(r.outputFiles=a.map(f=>f.replace(/Generated.*?:\s*/,"")));const s=e.match(/Mesh reduction:\s*([\d.]+)%/i);s&&(r.meshReduction=parseFloat(s[1]));const o=e.match(/Triangles:\s*(\d+)\s*->\s*(\d+)/i);o&&(r.triangleCount={before:parseInt(o[1]),after:parseInt(o[2])});const d=e.match(/Memory savings:\s*([\d.]+)\s*MB/i);return d&&(r.estimatedMemorySavings=parseFloat(d[1])),r.fullLog=e,r},k=e=>{const r={},a=e.match(/Created\s*(\d+)\s*precombined NIF/i);a&&(r.outputNifs=parseInt(a[1]));const s=e.match(/Processed\s*(\d+)\s*meshes?/i);s&&(r.totalMeshes=parseInt(s[1]));const o=e.match(/BA2:\s*([^\n]+\.ba2)/i);o&&(r.outputBA2=o[1].trim());const d=e.match(/Compression ratio:\s*([\d.]+)%/i);return d&&(r.compressionRatio=parseFloat(d[1])),r.fullLog=e,r},I={"interior-dungeon":{interiorCells:!0,includeStatics:!0,includeDynamic:!1,prpMode:!0,billboardFallback:!1},"dense-exterior":{interiorCells:!1,includeStatics:!0,includeDynamic:!1,prpMode:!0,billboardFallback:!0},settlement:{interiorCells:!1,includeStatics:!0,includeDynamic:!0,prpMode:!1,billboardFallback:!1}},[h,N]=c.useState([]),[g,b]=c.useState([]),[n,y]=c.useState(null),[i,F]=c.useState(null),[S,B]=c.useState(""),[L,J]=c.useState(""),[m,v]=c.useState(new Set),[p,C]=c.useState(()=>{try{return localStorage.getItem("lorekeeper-lodgen-path")||""}catch{return""}}),[u,P]=c.useState(()=>{try{return localStorage.getItem("lorekeeper-pjm-path")||""}catch{return""}}),[w,M]=c.useState(""),l=(R=window.electron)==null?void 0:R.api;c.useEffect(()=>{const e=localStorage.getItem("lorekeeper-lod-assets");if(e)try{N(JSON.parse(e))}catch{N([])}const r=localStorage.getItem("lorekeeper-precombines");if(r)try{b(JSON.parse(r))}catch{b([])}},[]),c.useEffect(()=>{localStorage.setItem("lorekeeper-lod-assets",JSON.stringify(h))},[h]),c.useEffect(()=>{localStorage.setItem("lorekeeper-precombines",JSON.stringify(g))},[g]),c.useEffect(()=>{localStorage.setItem("lorekeeper-lodgen-path",p)},[p]),c.useEffect(()=>{localStorage.setItem("lorekeeper-pjm-path",u)},[u]);const T=async e=>{var r;if(!p){alert("Set LODGEN tool path first");return}v(a=>new Set(a).add(e.id));try{const a=["--input",e.sourceNif,"--lod-level",e.lodPass.replace("lod",""),"--output",e.targetDir,"--texture-reduction",e.textureReduction.toString(),"--merge-chance",e.mergeChance.toString(),...e.billboardMode!=="none"?["--billboard-mode",e.billboardMode]:[]],s=await((r=l==null?void 0:l.runTool)==null?void 0:r.call(l,{cmd:p,args:a})),o=[s==null?void 0:s.stdout,s==null?void 0:s.stderr].filter(Boolean).join(`
`)||"LOD generation completed.",d=O(o);N(f=>f.map(x=>x.id===e.id?{...x,status:(s==null?void 0:s.exitCode)===0?"done":"error",lastRun:new Date().toISOString().slice(0,16).replace("T"," "),errorLog:(s==null?void 0:s.exitCode)===0?"":o,outputFiles:d.outputFiles||[],meshReduction:d.meshReduction,estimatedMemorySavings:d.estimatedMemorySavings,triangleCount:d.triangleCount,fullLog:d.fullLog}:x))}catch(a){N(s=>s.map(o=>o.id===e.id?{...o,status:"error",errorLog:String(a),lastRun:new Date().toISOString().slice(0,16).replace("T"," ")}:o))}finally{v(a=>{const s=new Set(a);return s.delete(e.id),s})}},A=async e=>{var r;if(!u){alert("Set PJM tool path first");return}v(a=>new Set(a).add(e.id));try{const a=["--cells",e.cellRange,...e.interiorCells?["--interior"]:[],...e.includeStatics?["--statics"]:[],...e.includeDynamic?["--dynamic"]:[],...e.prpMode?["--prp"]:[],...e.billboardFallback?["--billboard-fallback"]:[]],s=await((r=l==null?void 0:l.runTool)==null?void 0:r.call(l,{cmd:u,args:a})),o=[s==null?void 0:s.stdout,s==null?void 0:s.stderr].filter(Boolean).join(`
`)||"Precombine job completed.",d=k(o);b(f=>f.map(x=>x.id===e.id?{...x,status:(s==null?void 0:s.exitCode)===0?"done":"error",lastRun:new Date().toISOString().slice(0,16).replace("T"," "),errorLog:(s==null?void 0:s.exitCode)===0?"":o,outputBA2:d.outputBA2||"",outputNifs:d.outputNifs,totalMeshes:d.totalMeshes,compressionRatio:d.compressionRatio,fullLog:d.fullLog}:x))}catch(a){b(s=>s.map(o=>o.id===e.id?{...o,status:"error",errorLog:String(a),lastRun:new Date().toISOString().slice(0,16).replace("T"," ")}:o))}finally{v(a=>{const s=new Set(a);return s.delete(e.id),s})}},j=e=>{const r=I[e];if(!r)return;const a={id:`prp-${Date.now()}`,name:`${e.replace("-"," ").toUpperCase()} (${new Date().toLocaleTimeString()})`,cellRange:"00000000-0000FFFF",preset:e,status:"pending",...r};b(s=>[a,...s]),M("")},E=h.filter(e=>e.name.toLowerCase().includes(S.toLowerCase())),G=g.filter(e=>e.name.toLowerCase().includes(L.toLowerCase())),$=h.filter(e=>e.status==="pending").length,z=h.filter(e=>e.status==="done").length,Y=g.filter(e=>e.status==="pending").length,_=g.filter(e=>e.status==="done").length;return t.jsxs("div",{className:"h-full flex flex-col bg-forge-dark text-slate-200",children:[t.jsxs("div",{className:"p-4 border-b border-slate-700 bg-forge-panel flex justify-between items-center z-10 shadow-md",children:[t.jsxs("div",{children:[t.jsxs("h2",{className:"text-xl font-bold text-white flex items-center gap-2",children:[t.jsx(K,{className:"w-6 h-6 text-forge-accent"}),"The Lorekeeper (LOD Gen & Precombines)"]}),t.jsx("p",{className:"text-xs text-slate-400 font-mono",children:"LODGEN • PRP • PJM – FO4 Optimization Pipeline"})]}),t.jsx("div",{className:"flex gap-2",children:t.jsxs("button",{className:"flex items-center gap-2 px-3 py-1.5 bg-slate-800 hover:bg-slate-700 border border-slate-600 rounded text-xs transition-colors",children:[t.jsx(H,{className:"w-3 h-3"})," Settings"]})})]}),t.jsxs("div",{className:"flex-1 overflow-y-auto p-6 flex flex-col gap-6",children:[t.jsxs("div",{className:"bg-slate-900/60 border border-slate-800 rounded-xl p-4",children:[t.jsxs("div",{className:"flex items-center gap-2 text-sm font-semibold text-white mb-3",children:[t.jsx(q,{className:"w-4 h-4 text-forge-accent"})," Tool Paths"]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:"w-24 text-slate-500 text-xs",children:"LODGEN"}),t.jsx("input",{value:p,onChange:e=>C(e.target.value),placeholder:"Path to LODGEN.exe",className:"flex-1 bg-slate-950 border border-slate-800 rounded px-2 py-1 text-xs text-slate-200"}),t.jsx("button",{onClick:async()=>{var r;const e=await((r=l==null?void 0:l.pickToolPath)==null?void 0:r.call(l,"LODGEN"));e&&C(e)},className:"px-2 py-1 border border-slate-700 rounded hover:border-forge-accent text-xs",children:"Browse"})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:"w-24 text-slate-500 text-xs",children:"PJM"}),t.jsx("input",{value:u,onChange:e=>P(e.target.value),placeholder:"Path to PJM.exe",className:"flex-1 bg-slate-950 border border-slate-800 rounded px-2 py-1 text-xs text-slate-200"}),t.jsx("button",{onClick:async()=>{var r;const e=await((r=l==null?void 0:l.pickToolPath)==null?void 0:r.call(l,"PJM"));e&&P(e)},className:"px-2 py-1 border border-slate-700 rounded hover:border-forge-accent text-xs",children:"Browse"})]})]})]}),t.jsxs("div",{className:"bg-slate-900/60 border border-slate-800 rounded-xl p-4",children:[t.jsxs("div",{className:"flex items-center justify-between mb-3",children:[t.jsxs("div",{className:"flex items-center gap-2 text-sm font-semibold text-white",children:[t.jsx(U,{className:"w-4 h-4 text-amber-400"})," LOD Generation (LODGEN)"]}),t.jsxs("div",{className:"text-xs text-slate-400",children:[z," done / ",$," pending"]})]}),t.jsx("input",{type:"text",placeholder:"Search LOD assets...",value:S,onChange:e=>B(e.target.value),className:"w-full bg-slate-950 border border-slate-800 rounded px-2 py-1 text-xs text-slate-200 mb-3"}),t.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:E.map(e=>t.jsxs("div",{className:"bg-slate-950/60 border border-slate-800 rounded p-3",children:[t.jsxs("div",{className:"flex items-start justify-between mb-2",children:[t.jsxs("div",{children:[t.jsx("p",{className:"font-bold text-white text-sm",children:e.name}),t.jsx("p",{className:"text-xs text-slate-400",children:e.sourceNif})]}),t.jsx("span",{className:`px-2 py-0.5 rounded text-[10px] uppercase font-bold border ${e.status==="done"?"bg-emerald-900/20 text-emerald-400 border-emerald-700":e.status==="error"?"bg-red-900/20 text-red-400 border-red-700":e.status==="processing"?"bg-blue-900/20 text-blue-400 border-blue-700":"bg-slate-800 text-slate-300 border-slate-700"}`,children:e.status})]}),t.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2 text-xs mb-2",children:[t.jsxs("div",{children:["LOD Pass: ",t.jsx("span",{className:"text-forge-accent font-mono",children:e.lodPass})]}),t.jsxs("div",{children:["Texture Reduction: ",t.jsxs("span",{className:"text-forge-accent",children:[e.textureReduction,"%"]})]}),t.jsxs("div",{children:["Merge: ",t.jsxs("span",{className:"text-forge-accent",children:[e.mergeChance,"%"]})]}),t.jsxs("div",{children:["Billboard: ",t.jsx("span",{className:"text-forge-accent",children:e.billboardMode})]})]}),e.status==="done"&&(e.meshReduction!==void 0||e.estimatedMemorySavings!==void 0)&&t.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-2 text-xs mb-2 bg-emerald-900/20 border border-emerald-700 rounded p-2",children:[e.meshReduction!==void 0&&t.jsxs("div",{children:["Mesh Reduction: ",t.jsxs("span",{className:"text-emerald-400 font-bold",children:[e.meshReduction,"%"]})]}),e.estimatedMemorySavings!==void 0&&t.jsxs("div",{children:["Memory Saved: ",t.jsxs("span",{className:"text-emerald-400 font-bold",children:[e.estimatedMemorySavings," MB"]})]}),e.triangleCount&&t.jsxs("div",{children:["Triangles: ",t.jsxs("span",{className:"text-emerald-400 font-mono",children:[e.triangleCount.before," → ",e.triangleCount.after]})]})]}),t.jsxs("div",{className:"flex gap-2",children:[t.jsxs("button",{onClick:()=>T(e),disabled:m.has(e.id)||!p,className:`flex-1 px-2 py-1 text-xs rounded font-bold flex items-center justify-center gap-1 ${m.has(e.id)?"bg-slate-700 text-slate-500 cursor-not-allowed":"bg-forge-accent text-slate-900 hover:bg-sky-400"}`,children:[t.jsx(D,{className:"w-3 h-3"})," ",m.has(e.id)?"Processing...":"Generate"]}),e.errorLog&&t.jsx("button",{onClick:()=>y(e),className:"px-2 py-1 text-xs rounded border border-red-700 text-red-400 hover:bg-red-900/20",children:t.jsx(Q,{className:"w-3 h-3"})})]}),e.lastRun&&t.jsxs("p",{className:"text-[10px] text-slate-500 mt-1",children:["Last run: ",e.lastRun]})]},e.id))})]}),t.jsxs("div",{className:"bg-slate-900/60 border border-slate-800 rounded-xl p-4",children:[t.jsxs("div",{className:"flex items-center justify-between mb-3",children:[t.jsxs("div",{className:"flex items-center gap-2 text-sm font-semibold text-white",children:[t.jsx(V,{className:"w-4 h-4 text-purple-400"})," Precombine Jobs (PRP/PJM)"]}),t.jsxs("div",{className:"text-xs text-slate-400",children:[_," done / ",Y," pending"]})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-2 mb-3",children:[t.jsx("button",{onClick:()=>j("interior-dungeon"),className:"px-2 py-1.5 bg-slate-800 hover:bg-slate-700 border border-slate-700 rounded text-xs font-bold flex items-center justify-center gap-1",children:"+ Interior Dungeon"}),t.jsx("button",{onClick:()=>j("dense-exterior"),className:"px-2 py-1.5 bg-slate-800 hover:bg-slate-700 border border-slate-700 rounded text-xs font-bold flex items-center justify-center gap-1",children:"+ Dense Exterior"}),t.jsx("button",{onClick:()=>j("settlement"),className:"px-2 py-1.5 bg-slate-800 hover:bg-slate-700 border border-slate-700 rounded text-xs font-bold flex items-center justify-center gap-1",children:"+ Settlement"}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx("input",{type:"text",placeholder:"Custom name...",value:w,onChange:e=>M(e.target.value),className:"flex-1 bg-slate-950 border border-slate-800 rounded px-2 py-1 text-xs text-slate-200"}),t.jsx("button",{onClick:()=>w&&j("custom"),disabled:!w,className:"px-2 py-1.5 bg-purple-700 hover:bg-purple-600 disabled:bg-slate-800 disabled:text-slate-600 rounded text-xs font-bold",children:"Add"})]})]}),t.jsx("input",{type:"text",placeholder:"Search precombine jobs...",value:L,onChange:e=>J(e.target.value),className:"w-full bg-slate-950 border border-slate-800 rounded px-2 py-1 text-xs text-slate-200 mb-3"}),t.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:G.map(e=>t.jsxs("div",{className:"bg-slate-950/60 border border-slate-800 rounded p-3",children:[t.jsxs("div",{className:"flex items-start justify-between mb-2",children:[t.jsxs("div",{children:[t.jsx("p",{className:"font-bold text-white text-sm",children:e.name}),t.jsxs("p",{className:"text-xs text-slate-400",children:["Cell Range: ",e.cellRange," ",e.preset&&t.jsxs("span",{className:"text-purple-400",children:["| Preset: ",e.preset.replace("-"," ")]})]})]}),t.jsx("span",{className:`px-2 py-0.5 rounded text-[10px] uppercase font-bold border ${e.status==="done"?"bg-emerald-900/20 text-emerald-400 border-emerald-700":e.status==="error"?"bg-red-900/20 text-red-400 border-red-700":e.status==="processing"?"bg-blue-900/20 text-blue-400 border-blue-700":"bg-slate-800 text-slate-300 border-slate-700"}`,children:e.status})]}),t.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2 text-xs mb-2",children:[t.jsxs("div",{children:["Mode: ",t.jsx("span",{className:"text-forge-accent",children:e.prpMode?"PRP":"Standard"})]}),t.jsxs("div",{children:["Interior: ",t.jsx("span",{className:"text-forge-accent",children:e.interiorCells?"Yes":"No"})]}),t.jsxs("div",{children:["Statics: ",t.jsx("span",{className:"text-forge-accent",children:e.includeStatics?"Yes":"No"})]}),t.jsxs("div",{children:["Billboard: ",t.jsx("span",{className:"text-forge-accent",children:e.billboardFallback?"Yes":"No"})]})]}),e.status==="done"&&(e.outputNifs!==void 0||e.compressionRatio!==void 0)&&t.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-2 text-xs mb-2 bg-emerald-900/20 border border-emerald-700 rounded p-2",children:[e.outputNifs!==void 0&&t.jsxs("div",{children:["Output NIFs: ",t.jsx("span",{className:"text-emerald-400 font-bold",children:e.outputNifs})]}),e.totalMeshes!==void 0&&t.jsxs("div",{children:["Meshes: ",t.jsx("span",{className:"text-emerald-400 font-bold",children:e.totalMeshes})]}),e.compressionRatio!==void 0&&t.jsxs("div",{children:["Compression: ",t.jsxs("span",{className:"text-emerald-400 font-bold",children:[e.compressionRatio,"%"]})]})]}),t.jsxs("div",{className:"flex gap-2",children:[t.jsxs("button",{onClick:()=>A(e),disabled:m.has(e.id)||!u,className:`flex-1 px-2 py-1 text-xs rounded font-bold flex items-center justify-center gap-1 ${m.has(e.id)?"bg-slate-700 text-slate-500 cursor-not-allowed":"bg-purple-600 text-white hover:bg-purple-500"}`,children:[t.jsx(D,{className:"w-3 h-3"})," ",m.has(e.id)?"Processing...":"Run PJM"]}),e.outputBA2&&t.jsx("button",{onClick:()=>{var r;return(r=navigator.clipboard)==null?void 0:r.writeText(e.outputBA2||"")},className:"px-2 py-1 text-xs rounded border border-slate-600 text-slate-300 hover:border-forge-accent",children:t.jsx(W,{className:"w-3 h-3"})})]}),e.lastRun&&t.jsxs("p",{className:"text-[10px] text-slate-500 mt-1",children:["Last run: ",e.lastRun]})]},e.id))})]}),(n||i)&&t.jsxs("div",{className:"bg-slate-900/60 border border-slate-800 rounded-xl p-4",children:[t.jsxs("div",{className:"flex items-center justify-between mb-3",children:[t.jsx("h3",{className:"text-sm font-semibold text-white",children:"Details"}),t.jsx("button",{onClick:()=>{y(null),F(null)},className:"text-slate-500 hover:text-white text-lg",children:"×"})]}),n&&t.jsxs("div",{className:"bg-slate-950/60 rounded p-3 text-xs max-h-96 overflow-y-auto",children:[t.jsxs("p",{className:"text-slate-300 mb-2",children:[t.jsx("strong",{children:"Asset:"})," ",n.name]}),n.meshReduction!==void 0&&t.jsxs("div",{className:"mb-2 text-slate-300",children:[t.jsx("strong",{children:"Metrics:"})," ",n.meshReduction,"% mesh reduction, ",n.estimatedMemorySavings," MB saved",n.triangleCount&&t.jsxs("div",{className:"text-slate-400",children:["Triangles: ",n.triangleCount.before," → ",n.triangleCount.after]})]}),n.outputFiles.length>0&&t.jsxs("div",{className:"mb-2 text-slate-300",children:[t.jsx("strong",{children:"Generated:"}),n.outputFiles.map((e,r)=>t.jsx("div",{className:"text-slate-400 font-mono text-[10px]",children:e},r))]}),n.fullLog&&t.jsx("div",{className:"bg-slate-900 border border-slate-700 rounded p-2 text-red-300 font-mono whitespace-pre-wrap text-[10px]",children:n.fullLog}),n.errorLog&&t.jsx("div",{className:"bg-red-900/20 border border-red-700 rounded p-2 text-red-300 font-mono whitespace-pre-wrap",children:n.errorLog}),n.lastRun&&t.jsxs("p",{className:"text-slate-400 mt-2",children:["Last run: ",n.lastRun]})]}),i&&t.jsxs("div",{className:"bg-slate-950/60 rounded p-3 text-xs max-h-96 overflow-y-auto",children:[t.jsxs("p",{className:"text-slate-300 mb-2",children:[t.jsx("strong",{children:"Job:"})," ",i.name]}),i.outputNifs!==void 0&&t.jsxs("div",{className:"mb-2 text-slate-300",children:[t.jsx("strong",{children:"Output:"})," ",i.outputNifs," NIFs, ",i.totalMeshes," meshes processed",i.compressionRatio!==void 0&&t.jsxs("div",{className:"text-slate-400",children:["Compression ratio: ",i.compressionRatio,"%"]}),i.outputBA2&&t.jsxs("div",{className:"text-slate-400 font-mono text-[10px]",children:["BA2: ",i.outputBA2]})]}),i.fullLog&&t.jsx("div",{className:"bg-slate-900 border border-slate-700 rounded p-2 text-slate-300 font-mono whitespace-pre-wrap text-[10px]",children:i.fullLog}),i.errorLog&&t.jsx("div",{className:"bg-red-900/20 border border-red-700 rounded p-2 text-red-300 font-mono whitespace-pre-wrap",children:i.errorLog}),i.lastRun&&t.jsxs("p",{className:"text-slate-400 mt-2",children:["Last run: ",i.lastRun]})]})]})]})]})};export{oe as default};
