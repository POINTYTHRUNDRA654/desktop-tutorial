import{r as u,j as e,n as $,C as R}from"./index-CEqdjNqX.js";import{L as y}from"./loader-circle-BzIUkhYW.js";import{C as D}from"./circle-x-CTIhp6Mn.js";import{P as v}from"./play-txtn9UkQ.js";import{C as T}from"./copy-D3A4jLxT.js";import{D as E}from"./download-BCBaShzR.js";const V=()=>{const[m,x]=u.useState([{id:"electron-api",name:"Electron API Available",description:"Check if window.electron?.api is accessible",status:"idle",result:""},{id:"detect-programs",name:"detectPrograms() Function",description:"Check if detectPrograms function exists and is callable",status:"idle",result:""},{id:"get-system-info",name:"getSystemInfo() Function",description:"Check if getSystemInfo function exists and is callable",status:"idle",result:""},{id:"desktop-bridge",name:"Desktop Bridge Active",description:"Check if mossy_bridge_active is set in localStorage",status:"idle",result:""},{id:"storage-available",name:"localStorage Available",description:"Verify localStorage is accessible for caching",status:"idle",result:""}]),[d,o]=u.useState(""),[g,c]=u.useState(!1),I=async()=>{var r,p,h,b,f,w,N;const t=m.map(i=>({...i,status:"checking",result:"",errorDetails:""}));x(t),t[0].status="success";const l=!!((r=window.electron)!=null&&r.api)||!!window.electronAPI;t[0].result=l?"Available":"Not Available",t[0].status=l?"success":"error",t[1].status="checking";const a=typeof((h=(p=window.electron)==null?void 0:p.api)==null?void 0:h.detectPrograms)=="function"?window.electron.api.detectPrograms:typeof((b=window.electronAPI)==null?void 0:b.detectPrograms)=="function"?window.electronAPI.detectPrograms:null;t[1].result=a?"Function exists and callable":"Function not found",t[1].status=a?"success":"error",t[2].status="checking";const s=typeof((w=(f=window.electron)==null?void 0:f.api)==null?void 0:w.getSystemInfo)=="function"?window.electron.api.getSystemInfo:typeof((N=window.electronAPI)==null?void 0:N.getSystemInfo)=="function"?window.electronAPI.getSystemInfo:null;t[2].result=s?"Function exists and callable":"Function not found",t[2].status=s?"success":"error",t[3].status="checking";const n=localStorage.getItem("mossy_bridge_active")==="true";t[3].result=n?"Active":"Inactive",t[3].status=n?"success":"error",t[4].status="checking";try{const i="__diagnostic_test__";localStorage.setItem(i,"test");const j=localStorage.getItem(i);localStorage.removeItem(i),t[4].result=j==="test"?"Fully functional":"Read/write issue",t[4].status=j==="test"?"success":"error"}catch(i){t[4].result="Error",t[4].errorDetails=i.message,t[4].status="error"}x(t)},A=async()=>{var t;c(!0),o(`Testing detectPrograms()...
`);try{const l=((t=window.electron)==null?void 0:t.api)||window.electronAPI;if(!(l!=null&&l.detectPrograms)){o(s=>s+`
❌ ERROR: detectPrograms function not found
`),c(!1);return}o(s=>s+`✓ Function found
`),o(s=>s+`⏳ Calling detectPrograms()...
`);const a=await l.detectPrograms();if(!a){o(s=>s+`❌ ERROR: detectPrograms returned null/undefined
`),c(!1);return}if(!Array.isArray(a)){o(s=>s+`⚠️  WARNING: Result is not an array, got ${typeof a}
`),c(!1);return}o(s=>s+`✓ detectPrograms returned ${a.length} programs

`),o(s=>s+`First 10 results:
`),o(s=>s+"─".repeat(60)+`
`),a.slice(0,10).forEach((s,n)=>{o(r=>r+`${n+1}. Name: ${s.displayName||s.name}
`),o(r=>r+`   Path: ${s.path||"N/A"}
`),s.version&&o(r=>r+`   Version: ${s.version}
`),o(r=>r+`
`)}),o(s=>s+`
✓ Test completed successfully (${a.length} total programs found)`)}catch(l){o(a=>a+`
❌ ERROR: ${l.message}
`),o(a=>a+`
Stack: ${l.stack}`)}c(!1)},P=()=>{var n;const t=`MOSSY DIAGNOSTIC REPORT
Generated: ${new Date().toISOString()}

=== SYSTEM CHECKS ===
${m.map(r=>`${r.status==="success"?"✓":r.status==="error"?"✗":"?"} ${r.name}: ${r.result}${r.errorDetails?` (${r.errorDetails})`:""}`).join(`
`)}

=== DETECTION TEST OUTPUT ===
${d||"(No test run yet)"}

=== ENVIRONMENT INFO ===
User Agent: ${navigator.userAgent}
Platform: ${navigator.platform}
Language: ${navigator.language}
LocalStorage Enabled: ${S()}

=== API AVAILABILITY ===
window.electron exists: ${!!window.electron}
window.electronAPI exists: ${!!window.electronAPI}
electron.api exists: ${!!((n=window.electron)!=null&&n.api)}
electronAPI exists: ${!!window.electronAPI}

=== DETECTED APIS ===
${C()}
`,l=new Blob([t],{type:"text/plain"}),a=URL.createObjectURL(l),s=document.createElement("a");s.href=a,s.download=`mossy-diagnostics-${new Date().toISOString().split("T")[0]}.txt`,document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(a)},S=()=>{try{return localStorage.setItem("__test__","test"),localStorage.removeItem("__test__"),!0}catch{return!1}},C=()=>{var l;const t=((l=window.electron)==null?void 0:l.api)||window.electronAPI||{};return Object.keys(t).map(a=>`- ${a}: ${typeof t[a]}`).join(`
`)};return e.jsx("div",{className:"min-h-screen bg-slate-950 p-8 pb-20",children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx($,{className:"w-8 h-8 text-cyan-400"}),e.jsx("h1",{className:"text-4xl font-bold text-white",children:"Diagnostic Tools"})]}),e.jsx("p",{className:"text-slate-400",children:"Run system diagnostics to check if all Mossy APIs are properly configured. Use this to troubleshoot issues."})]}),e.jsxs("div",{className:"bg-slate-900 border border-slate-700 rounded-xl overflow-hidden mb-8",children:[e.jsxs("div",{className:"bg-slate-800 border-b border-slate-700 p-6",children:[e.jsx("h2",{className:"text-xl font-bold text-white",children:"System Checks"}),e.jsx("p",{className:"text-slate-400 text-sm mt-2",children:"Verify that all required APIs are available"})]}),e.jsxs("div",{className:"p-6 space-y-4",children:[m.map(t=>e.jsx("div",{className:"bg-slate-800/50 rounded-lg p-4 border border-slate-700",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsxs("div",{className:"pt-1",children:[t.status==="idle"&&e.jsx("div",{className:"w-5 h-5 rounded-full bg-slate-600"}),t.status==="checking"&&e.jsx(y,{className:"w-5 h-5 text-yellow-400 animate-spin"}),t.status==="success"&&e.jsx(R,{className:"w-5 h-5 text-emerald-400"}),t.status==="error"&&e.jsx(D,{className:"w-5 h-5 text-red-400"})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-bold text-white",children:t.name}),e.jsx("p",{className:"text-xs text-slate-400 mt-1",children:t.description}),t.result&&e.jsx("p",{className:`text-sm mt-2 font-mono ${t.status==="success"?"text-emerald-300":"text-red-300"}`,children:t.result}),t.errorDetails&&e.jsx("p",{className:"text-xs text-red-400 mt-2",children:t.errorDetails})]})]})},t.id)),e.jsxs("button",{onClick:I,className:"w-full px-4 py-3 rounded-lg bg-cyan-600 hover:bg-cyan-700 text-white font-bold transition-colors flex items-center justify-center gap-2 mt-6",children:[e.jsx(v,{className:"w-4 h-4"}),"Run All Checks"]})]})]}),e.jsxs("div",{className:"bg-slate-900 border border-slate-700 rounded-xl overflow-hidden mb-8",children:[e.jsxs("div",{className:"bg-slate-800 border-b border-slate-700 p-6",children:[e.jsx("h2",{className:"text-xl font-bold text-white",children:"Detection Test"}),e.jsx("p",{className:"text-slate-400 text-sm mt-2",children:"Attempt to detect installed programs and show results"})]}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsx("button",{onClick:A,disabled:g,className:"w-full px-4 py-3 rounded-lg bg-blue-600 hover:bg-blue-700 disabled:bg-slate-700 text-white font-bold transition-colors flex items-center justify-center gap-2",children:g?e.jsxs(e.Fragment,{children:[e.jsx(y,{className:"w-4 h-4 animate-spin"}),"Running Detection..."]}):e.jsxs(e.Fragment,{children:[e.jsx(v,{className:"w-4 h-4"}),"Test detectPrograms()"]})}),d&&e.jsxs("div",{className:"bg-slate-800/50 rounded-lg p-4 border border-slate-700",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("h3",{className:"font-bold text-white text-sm",children:"Test Output:"}),e.jsxs("button",{onClick:()=>{navigator.clipboard.writeText(d),alert("Output copied to clipboard")},className:"text-xs text-slate-400 hover:text-white transition-colors flex items-center gap-1",children:[e.jsx(T,{className:"w-3 h-3"}),"Copy"]})]}),e.jsx("pre",{className:"text-xs text-slate-300 overflow-auto max-h-64 bg-slate-900/50 rounded p-3 whitespace-pre-wrap break-words",children:d})]})]})]}),e.jsxs("div",{className:"bg-slate-900 border border-slate-700 rounded-xl overflow-hidden",children:[e.jsxs("div",{className:"bg-slate-800 border-b border-slate-700 p-6",children:[e.jsx("h2",{className:"text-xl font-bold text-white",children:"Export Diagnostics"}),e.jsx("p",{className:"text-slate-400 text-sm mt-2",children:"Download a complete diagnostic report to share with support"})]}),e.jsx("div",{className:"p-6",children:e.jsxs("button",{onClick:P,className:"w-full px-4 py-3 rounded-lg bg-purple-600 hover:bg-purple-700 text-white font-bold transition-colors flex items-center justify-center gap-2",children:[e.jsx(E,{className:"w-4 h-4"}),"Export Full Diagnostic Report"]})})]})]})})};export{V as default};
