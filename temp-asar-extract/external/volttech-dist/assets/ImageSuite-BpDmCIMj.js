import{c as J,r as l,e as V,j as e,q as I,C as Q,I as U}from"./index-CEqdjNqX.js";import{U as K}from"./upload-CcCAxFJ0.js";import{T as X}from"./triangle-alert-zWUHrt1_.js";import{D as v}from"./download-BCBaShzR.js";/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Y=[["path",{d:"M3 7V5a2 2 0 0 1 2-2h2",key:"aa7l1z"}],["path",{d:"M17 3h2a2 2 0 0 1 2 2v2",key:"4qcy5o"}],["path",{d:"M21 17v2a2 2 0 0 1-2 2h-2",key:"6vwrx8"}],["path",{d:"M7 21H5a2 2 0 0 1-2-2v-2",key:"ioqczr"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}],["path",{d:"m16 16-1.9-1.9",key:"1dq9hf"}]],M=J("scan-search",Y),re=()=>{const[c,D]=l.useState("pbr"),[a,z]=l.useState(null),[o,_]=l.useState(null),[k,F]=l.useState(!1),[u,q]=l.useState("png"),[P,T]=l.useState("BC1_UNORM"),[R,S]=l.useState(!1),[i,E]=l.useState(!0),[L,C]=l.useState(null),[j,O]=l.useState(!0),[N,H]=l.useState(0);let B=null;try{B=V()}catch{console.warn("[ImageSuite] LiveContext not available, using fallback"),B={setAvatarFromUrl:()=>{}}}const{setAvatarFromUrl:Z}=B,[s,$]=l.useState({normal:null,roughness:null,height:null,metallic:null,ao:null});l.useEffect(()=>{if(a){const t=URL.createObjectURL(a);return _(t),()=>URL.revokeObjectURL(t)}else _(null)},[a]);const A=async()=>{if(!(!a&&!o)){F(!0);try{const t=a,d=new FileReader;d.onload=async x=>{var b;const m=(b=x.target)==null?void 0:b.result;try{const[r,h,g,n,p]=await Promise.all([window.electron.api.generateNormalMap(m),window.electron.api.generateRoughnessMap(m),window.electron.api.generateHeightMap(m),window.electron.api.generateMetallicMap(m),window.electron.api.generateAOMap(m)]);$({normal:r,roughness:h,height:g,metallic:n,ao:p})}catch(r){console.error("PBR generation error:",r),alert("Failed to generate PBR maps. Check console for details.")}finally{F(!1)}},d.readAsDataURL(t||(o?await fetch(o).then(x=>x.blob()):null))}catch(t){console.error("File reading error:",t),F(!1)}}},G=async()=>{if(!(!a&&!o)){S(!0);try{const t=a,d=new FileReader;d.onload=async x=>{var b;const m=(b=x.target)==null?void 0:b.result;try{let r;if(u.toLowerCase()==="dds")try{const p=localStorage.getItem("vault-tool-paths-v1");if(p){const f=JSON.parse(p);f&&typeof f.texconv=="string"&&f.texconv.trim().length&&(r=f.texconv)}}catch{}const h=r?{texconvPath:r}:{};u.toLowerCase()==="dds"&&!i&&(h.bcFormat=P),u.toLowerCase()==="dds"&&(h.requireReal=j,h.mipmapLevels=N);const g=await window.electron.api.convertImageFormat(m,u,h);u.toLowerCase()==="dds"&&(typeof g=="string"&&g.startsWith("data:converted-dds-")?C("Real DDS export not available. Configure texconv in The Vault or add it to PATH."):C(null));const n=document.createElement("a");n.href=g,n.download=`converted-image.${u.toLowerCase()}`,document.body.appendChild(n),n.click(),document.body.removeChild(n)}catch(r){console.error("Format conversion error:",r),alert("Failed to convert image format. Check console for details.")}finally{S(!1)}},d.readAsDataURL(t||(o?await fetch(o).then(x=>x.blob()):null))}catch(t){console.error("File reading error:",t),S(!1)}}},W=async()=>{if(!a)return;const t=a.name.replace(/\.[^.]+$/,"");try{(!s.normal||!s.roughness)&&await A();const d=s.normal,x=s.roughness,m=o;if(!m||!d||!x)return;const b=(f,w)=>{const y=document.createElement("a");y.href=f,y.download=w,document.body.appendChild(y),y.click(),document.body.removeChild(y)};let r;try{const f=localStorage.getItem("vault-tool-paths-v1");if(f){const w=JSON.parse(f);w&&typeof w.texconv=="string"&&w.texconv.trim().length&&(r=w.texconv)}}catch{}const h=await window.electron.api.convertImageFormat(m,"dds",{bcFormat:"BC7_UNORM",texconvPath:r,requireReal:j,mipmapLevels:N}),g=await window.electron.api.convertImageFormat(d,"dds",{bcFormat:"BC5_UNORM",texconvPath:r,requireReal:j,mipmapLevels:N}),n=await window.electron.api.convertImageFormat(x,"dds",{bcFormat:"BC5_UNORM",texconvPath:r,requireReal:j,mipmapLevels:N}),p=[];typeof h=="string"&&h.startsWith("data:converted-dds-")&&p.push("_d/BC7"),typeof g=="string"&&g.startsWith("data:converted-dds-")&&p.push("_n/BC5"),typeof n=="string"&&n.startsWith("data:converted-dds-")&&p.push("_s/BC5"),p.length?C(`Real DDS export not available for ${p.join(", ")}. Configure texconv in The Vault or add it to PATH.`):C(null),b(h,`${t}_d.dds`),b(g,`${t}_n.dds`),b(n,`${t}_s.dds`)}catch(d){console.error("FO4 export error:",d),alert("Export failed. Please check console for details.")}};return e.jsxs("div",{className:"h-full flex flex-col bg-forge-dark text-slate-200",children:[e.jsxs("div",{className:"flex border-b border-slate-700 bg-forge-panel",children:[e.jsxs("button",{onClick:()=>D("pbr"),className:`flex-1 p-4 flex items-center justify-center gap-2 font-medium ${c==="pbr"?"border-b-2 border-forge-accent text-forge-accent":"text-slate-400 hover:text-white"}`,children:[e.jsx(I,{className:"w-5 h-5"})," PBR Synthesizer"]}),e.jsxs("button",{onClick:()=>D("convert"),className:`flex-1 p-4 flex items-center justify-center gap-2 font-medium ${c==="convert"?"border-b-2 border-forge-accent text-forge-accent":"text-slate-400 hover:text-white"}`,children:[e.jsx(M,{className:"w-5 h-5"})," Format Converter"]})]}),e.jsx("div",{className:"flex-1 p-6 overflow-y-auto",children:e.jsxs("div",{className:"max-w-5xl mx-auto grid grid-cols-1 lg:grid-cols-12 gap-8",children:[e.jsx("div",{className:"lg:col-span-4 space-y-6",children:e.jsxs("div",{className:"bg-forge-panel p-6 rounded-xl border border-slate-700",children:[e.jsx("h3",{className:"text-xl font-bold mb-4 text-white",children:c==="pbr"?"PBR Map Synthesizer":"Format Converter"}),c==="pbr"&&e.jsx("p",{className:"text-xs text-slate-400 mb-4",children:"Automatically generate Normal, Roughness, Height, Metallic, and Ambient Occlusion maps from any source image for game-ready textures."}),c==="convert"&&e.jsx("p",{className:"text-xs text-slate-400 mb-4",children:"Convert textures between PNG, JPG, TGA, and DDS formats with customizable compression options."}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-slate-400 mb-2",children:"Source Image"}),e.jsxs("div",{className:"border-2 border-dashed border-slate-600 rounded-lg p-4 text-center hover:border-forge-accent cursor-pointer transition-colors relative h-32 flex items-center justify-center",children:[e.jsx("input",{type:"file",className:"absolute inset-0 opacity-0 cursor-pointer",accept:"image/*",onChange:t=>t.target.files&&z(t.target.files[0])}),a?e.jsxs("div",{className:"relative z-10",children:[e.jsx("div",{className:"text-forge-accent font-medium truncate max-w-[200px]",children:a.name}),e.jsxs("div",{className:"text-xs text-slate-500 mt-1",children:[(a.size/1024).toFixed(0)," KB"]})]}):e.jsxs("div",{className:"text-slate-500 flex flex-col items-center",children:[e.jsx(K,{className:"w-8 h-8 mb-2 opacity-50"}),"Drag & drop or click"]})]})]}),L&&e.jsxs("div",{className:"mb-4 flex items-start gap-2 bg-amber-900/30 border border-amber-700/50 text-amber-200 rounded-lg p-3 text-xs",children:[e.jsx(X,{className:"w-4 h-4 mt-0.5 flex-shrink-0"}),e.jsx("div",{className:"leading-snug",children:L})]}),c==="pbr"&&e.jsxs("div",{className:"mb-4 flex items-center justify-between bg-slate-900/60 border border-slate-700 rounded-lg p-3",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm font-medium text-white flex items-center gap-2",children:[e.jsx(Q,{className:"w-4 h-4 text-forge-accent"})," Fallout 4 Preset"]}),e.jsx("div",{className:"text-xs text-slate-400",children:"Locks exports to _d/_n/_s → BC7/BC5/BC5"})]}),e.jsx("button",{onClick:()=>E(t=>!t),className:`px-3 py-1 rounded-md text-xs font-semibold border ${i?"bg-forge-accent text-slate-900 border-sky-400":"bg-slate-800 text-slate-300 border-slate-600"}`,children:i?"Enabled":"Disabled"})]}),c==="pbr"&&e.jsxs("div",{className:"mb-4 flex items-center justify-between bg-slate-900/40 border border-slate-700/60 rounded-lg p-3",children:[e.jsx("div",{className:"text-xs text-slate-300",children:"Require real DDS (no fallback)"}),e.jsxs("label",{className:"inline-flex items-center gap-2 text-xs text-slate-300",children:[e.jsx("input",{id:"require-real-dds-pbr",type:"checkbox",className:"accent-sky-400",checked:j,onChange:t=>O(t.target.checked)}),e.jsx("span",{className:"text-slate-300",children:"Enabled"})]})]}),c==="convert"&&e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-slate-400 mb-2",children:"Target Format"}),e.jsxs("select",{value:u,onChange:t=>q(t.target.value),className:"w-full bg-slate-900 border border-slate-700 rounded p-2 text-sm",disabled:i,children:[e.jsx("option",{value:"png",children:"PNG (Lossless)"}),e.jsx("option",{value:"jpg",children:"JPG (Lossy)"}),e.jsx("option",{value:"tga",children:"TGA (Uncompressed)"}),e.jsx("option",{value:"dds",children:"DDS (BC1/BC3/BC5/BC7)"})]}),i&&e.jsx("div",{className:"text-[10px] text-slate-400 mt-1",children:"FO4 preset enabled: conversion options locked to BC7/BC5."}),!i&&u.toLowerCase()==="dds"&&e.jsxs("div",{className:"mt-3",children:[e.jsx("label",{className:"block text-sm font-medium text-slate-400 mb-2",children:"DDS Compression"}),e.jsxs("select",{value:P,onChange:t=>T(t.target.value),className:"w-full bg-slate-900 border border-slate-700 rounded p-2 text-sm",children:[e.jsx("option",{value:"BC1_UNORM",children:"BC1 (Albedo Opaque)"}),e.jsx("option",{value:"BC3_UNORM",children:"BC3 (Albedo with Alpha)"}),e.jsx("option",{value:"BC5_UNORM",children:"BC5 (Normal Map)"}),e.jsx("option",{value:"BC7_UNORM",children:"BC7 (High Quality)"})]}),e.jsx("div",{className:"text-[10px] text-slate-500 mt-1",children:"Tip: FO4 normals → BC5; opaque albedo → BC1; HQ albedo → BC7."})]}),(i||u.toLowerCase()==="dds")&&e.jsxs("div",{className:"mt-3 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between bg-slate-900/40 border border-slate-700/60 rounded-lg p-3",children:[e.jsx("div",{className:"text-xs text-slate-300",children:"Require real DDS (no fallback)"}),e.jsxs("label",{className:"inline-flex items-center gap-2 text-xs text-slate-300",children:[e.jsx("input",{id:"require-real-dds-convert",type:"checkbox",className:"accent-sky-400",checked:j,onChange:t=>O(t.target.checked)}),e.jsx("span",{className:"text-slate-300",children:"Enabled"})]})]}),e.jsxs("div",{className:"bg-slate-900/40 border border-slate-700/60 rounded-lg p-3",children:[e.jsx("label",{className:"block text-xs text-slate-300 mb-2",children:"Mipmap Levels (0 = none)"}),e.jsx("input",{id:"mipmap-levels-convert",type:"number",min:"0",max:"12",value:N,onChange:t=>H(Math.max(0,Math.min(12,parseInt(t.target.value)||0))),className:"w-full bg-slate-800 border border-slate-700 text-slate-200 rounded p-2 text-xs"}),e.jsxs("div",{className:"text-[10px] text-slate-500 mt-1",children:["Texconv flag: -m ",N]})]})]})]}),c==="pbr"?e.jsxs("button",{onClick:A,disabled:k||!a,className:"w-full py-3 bg-forge-accent text-slate-900 font-bold rounded-lg hover:bg-sky-400 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:[k?e.jsx(M,{className:"animate-spin"}):e.jsx(I,{}),k?"Synthesizing Maps...":"Generate PBR Maps"]}):e.jsxs("button",{onClick:i?W:G,disabled:R||!a,className:"w-full py-3 bg-forge-accent text-slate-900 font-bold rounded-lg hover:bg-sky-400 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:[R?e.jsx(M,{className:"animate-spin"}):e.jsx(v,{}),R?"Converting...":i?"Export FO4 DDS (_d/_n/_s)":"Convert & Download"]})]})}),e.jsx("div",{className:"lg:col-span-8",children:c==="pbr"?e.jsxs("div",{className:"grid grid-cols-3 gap-3 h-full",children:[e.jsxs("div",{className:"bg-black/50 rounded-xl border border-slate-800 p-3 relative group col-span-1 row-span-2",children:[e.jsx("span",{className:"absolute top-2 left-2 bg-black/70 px-2 py-1 rounded text-xs text-white z-10",children:"Source"}),o?e.jsx("img",{src:o,className:"w-full h-full object-cover rounded",alt:"Source"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-slate-600 border-2 border-dashed border-slate-700 rounded",children:e.jsx(U,{className:"w-8 h-8"})})]}),i?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-black/50 rounded-xl border border-slate-800 p-3 relative group",children:[e.jsx("span",{className:"absolute top-2 left-2 bg-blue-900/80 px-2 py-1 rounded text-xs text-blue-100 z-10",children:"Normal (_n → BC5)"}),s.normal?e.jsxs(e.Fragment,{children:[e.jsx("img",{src:s.normal,className:"w-full h-32 object-cover rounded",alt:"Normal"}),e.jsx("a",{href:s.normal,download:"normal_map.png",className:"absolute bottom-2 right-2 p-1 bg-white text-black rounded opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(v,{className:"w-3 h-3"})})]}):e.jsx("div",{className:"w-full h-32 flex items-center justify-center text-slate-700 text-xs",children:"Normal Map"})]}),e.jsxs("div",{className:"bg-black/50 rounded-xl border border-slate-800 p-3 relative group",children:[e.jsx("span",{className:"absolute top-2 left-2 bg-emerald-900/80 px-2 py-1 rounded text-xs text-emerald-100 z-10",children:"Specular (_s → BC5)"}),s.roughness?e.jsxs(e.Fragment,{children:[e.jsx("img",{src:s.roughness,className:"w-full h-32 object-cover rounded",alt:"Specular"}),e.jsx("a",{href:s.roughness,download:"specular_map.png",className:"absolute bottom-2 right-2 p-1 bg-white text-black rounded opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(v,{className:"w-3 h-3"})})]}):e.jsx("div",{className:"w-full h-32 flex items-center justify-center text-slate-700 text-xs",children:"Specular (from Roughness)"})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-black/50 rounded-xl border border-slate-800 p-3 relative group",children:[e.jsx("span",{className:"absolute top-2 left-2 bg-blue-900/80 px-2 py-1 rounded text-xs text-blue-100 z-10",children:"Normal"}),s.normal?e.jsxs(e.Fragment,{children:[e.jsx("img",{src:s.normal,className:"w-full h-32 object-cover rounded",alt:"Normal"}),e.jsx("a",{href:s.normal,download:"normal_map.png",className:"absolute bottom-2 right-2 p-1 bg-white text-black rounded opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(v,{className:"w-3 h-3"})})]}):e.jsx("div",{className:"w-full h-32 flex items-center justify-center text-slate-700 text-xs",children:"Normal Map"})]}),e.jsxs("div",{className:"bg-black/50 rounded-xl border border-slate-800 p-3 relative group",children:[e.jsx("span",{className:"absolute top-2 left-2 bg-gray-700/80 px-2 py-1 rounded text-xs text-gray-200 z-10",children:"Roughness"}),s.roughness?e.jsxs(e.Fragment,{children:[e.jsx("img",{src:s.roughness,className:"w-full h-32 object-cover rounded",alt:"Roughness"}),e.jsx("a",{href:s.roughness,download:"roughness_map.png",className:"absolute bottom-2 right-2 p-1 bg-white text-black rounded opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(v,{className:"w-3 h-3"})})]}):e.jsx("div",{className:"w-full h-32 flex items-center justify-center text-slate-700 text-xs",children:"Roughness"})]}),e.jsxs("div",{className:"bg-black/50 rounded-xl border border-slate-800 p-3 relative group",children:[e.jsx("span",{className:"absolute top-2 left-2 bg-purple-700/80 px-2 py-1 rounded text-xs text-purple-200 z-10",children:"Height"}),s.height?e.jsxs(e.Fragment,{children:[e.jsx("img",{src:s.height,className:"w-full h-32 object-cover rounded",alt:"Height"}),e.jsx("a",{href:s.height,download:"height_map.png",className:"absolute bottom-2 right-2 p-1 bg-white text-black rounded opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(v,{className:"w-3 h-3"})})]}):e.jsx("div",{className:"w-full h-32 flex items-center justify-center text-slate-700 text-xs",children:"Height"})]}),e.jsxs("div",{className:"bg-black/50 rounded-xl border border-slate-800 p-3 relative group",children:[e.jsx("span",{className:"absolute top-2 left-2 bg-yellow-700/80 px-2 py-1 rounded text-xs text-yellow-200 z-10",children:"Metallic"}),s.metallic?e.jsxs(e.Fragment,{children:[e.jsx("img",{src:s.metallic,className:"w-full h-32 object-cover rounded",alt:"Metallic"}),e.jsx("a",{href:s.metallic,download:"metallic_map.png",className:"absolute bottom-2 right-2 p-1 bg-white text-black rounded opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(v,{className:"w-3 h-3"})})]}):e.jsx("div",{className:"w-full h-32 flex items-center justify-center text-slate-700 text-xs",children:"Metallic"})]}),e.jsxs("div",{className:"bg-black/50 rounded-xl border border-slate-800 p-3 relative group",children:[e.jsx("span",{className:"absolute top-2 left-2 bg-amber-700/80 px-2 py-1 rounded text-xs text-amber-200 z-10",children:"Ambient Occlusion"}),s.ao?e.jsxs(e.Fragment,{children:[e.jsx("img",{src:s.ao,className:"w-full h-32 object-cover rounded",alt:"AO"}),e.jsx("a",{href:s.ao,download:"ao_map.png",className:"absolute bottom-2 right-2 p-1 bg-white text-black rounded opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(v,{className:"w-3 h-3"})})]}):e.jsx("div",{className:"w-full h-32 flex items-center justify-center text-slate-700 text-xs",children:"Ambient Occlusion"})]})]})]}):e.jsx("div",{className:"bg-black/50 rounded-xl border border-slate-800 flex items-center justify-center p-4 relative h-full min-h-[400px]",children:o?e.jsx("div",{className:"relative group w-full h-full flex items-center justify-center",children:e.jsx("img",{src:o,alt:"Preview",className:"max-w-full max-h-[500px] rounded shadow-2xl object-contain"})}):e.jsxs("div",{className:"text-slate-600 flex flex-col items-center",children:[e.jsx(U,{className:"w-16 h-16 mb-4 opacity-20"}),e.jsx("p",{children:"Image preview will appear here"})]})})})]})})]})};export{re as default};
